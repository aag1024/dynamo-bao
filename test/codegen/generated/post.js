// ðŸ§¨ ðŸ§¨ ðŸ§¨ ðŸ§¨ ðŸ§¨ ðŸ§¨ ðŸ§¨ ðŸ§¨ ðŸ§¨ ðŸ§¨ ðŸ§¨ ðŸ§¨ ðŸ§¨ ðŸ§¨ ðŸ§¨  
// DO NOT EDIT: Generated by model-codegen 
// ðŸ§¨ ðŸ§¨ ðŸ§¨ ðŸ§¨ ðŸ§¨ ðŸ§¨ ðŸ§¨ ðŸ§¨ ðŸ§¨ ðŸ§¨ ðŸ§¨ ðŸ§¨ ðŸ§¨ ðŸ§¨ ðŸ§¨ 

const { 
  BaseModel, 
  GSI_INDEX_ID1,
  GSI_INDEX_ID2,
  PrimaryKeyConfig,
  IndexConfig
} = require('dynamo-bao');

const { 
    UlidField,
    RelatedField,
    StringField,
    CreateDateField,
    VersionField
} = require('dynamo-bao').fields;

const { Comment } = require('./comment');
const { TaggedPost } = require('./tagged-post');

class Post extends BaseModel {
  static modelPrefix = 'p';
  
  static fields = {
    postId: UlidField({ autoAssign: true }),
    userId: RelatedField('User', { required: true }),
    title: StringField({ required: true }),
    content: StringField({ required: true }),
    createdAt: CreateDateField(),
    version: VersionField(),
  };

  static primaryKey = PrimaryKeyConfig('postId', 'modelPrefix');

  static indexes = {
    allPosts: IndexConfig('modelPrefix', 'postId', GSI_INDEX_ID1),
    postsForUser: IndexConfig('userId', 'createdAt', GSI_INDEX_ID2),
  };


  static async cgQueryAllPosts(skCondition = null, options = {}) {
    const results = await this.queryByIndex(
      'allPosts',
      this.modelPrefix,
      skCondition,
      options
    );

    return results;
  }
  async cgQueryComments(skCondition = null, options = {}) {
    const results = await Comment.queryByIndex(
      'commentsForPost',
      this.getPkValue(),
      skCondition,
      options
    );

    return results;
  }
  async cgGetComments(mapSkCondition=null, limit=null, direction='ASC', startKey=null) {
    return await Comment.getRelatedObjectsViaMap(
      "commentsForPost",
      this.getPkValue(),
      "authorId",
      mapSkCondition,
      limit,
      direction,
      startKey
    );
  }
  async cgGetTags(mapSkCondition=null, limit=null, direction='ASC', startKey=null) {
    return await TaggedPost.getRelatedObjectsViaMap(
      "tagsForPost",
      this.getPkValue(),
      "tagId",
      mapSkCondition,
      limit,
      direction,
      startKey
    );
  }

}

module.exports = { Post };
