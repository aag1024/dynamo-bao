<!DOCTYPE html><html lang="en" style="font-size:16px"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link type="text/css" rel="stylesheet" href="jsdoc.css"><title>Source: fields.js</title><!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]--><script src="scripts/third-party/hljs.js" defer="defer"></script><script src="scripts/third-party/hljs-line-num.js" defer="defer"></script><script src="scripts/third-party/popper.js" defer="defer"></script><script src="scripts/third-party/tippy.js" defer="defer"></script><script src="scripts/third-party/tocbot.min.js"></script><script>var baseURL="/",locationPathname="";baseURL=(locationPathname=document.location.pathname).substr(0,locationPathname.lastIndexOf("/")+1)</script><link rel="stylesheet" href="styles/clean-jsdoc-theme.min.css"><style>.gh-button-container{position:fixed;top:20px;right:200px;z-index:100}</style><svg aria-hidden="true" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" style="display:none"><defs><symbol id="copy-icon" viewbox="0 0 488.3 488.3"><g><path d="M314.25,85.4h-227c-21.3,0-38.6,17.3-38.6,38.6v325.7c0,21.3,17.3,38.6,38.6,38.6h227c21.3,0,38.6-17.3,38.6-38.6V124    C352.75,102.7,335.45,85.4,314.25,85.4z M325.75,449.6c0,6.4-5.2,11.6-11.6,11.6h-227c-6.4,0-11.6-5.2-11.6-11.6V124    c0-6.4,5.2-11.6,11.6-11.6h227c6.4,0,11.6,5.2,11.6,11.6V449.6z"/><path d="M401.05,0h-227c-21.3,0-38.6,17.3-38.6,38.6c0,7.5,6,13.5,13.5,13.5s13.5-6,13.5-13.5c0-6.4,5.2-11.6,11.6-11.6h227    c6.4,0,11.6,5.2,11.6,11.6v325.7c0,6.4-5.2,11.6-11.6,11.6c-7.5,0-13.5,6-13.5,13.5s6,13.5,13.5,13.5c21.3,0,38.6-17.3,38.6-38.6    V38.6C439.65,17.3,422.35,0,401.05,0z"/></g></symbol><symbol id="search-icon" viewBox="0 0 512 512"><g><g><path d="M225.474,0C101.151,0,0,101.151,0,225.474c0,124.33,101.151,225.474,225.474,225.474    c124.33,0,225.474-101.144,225.474-225.474C450.948,101.151,349.804,0,225.474,0z M225.474,409.323    c-101.373,0-183.848-82.475-183.848-183.848S124.101,41.626,225.474,41.626s183.848,82.475,183.848,183.848    S326.847,409.323,225.474,409.323z"/></g></g><g><g><path d="M505.902,476.472L386.574,357.144c-8.131-8.131-21.299-8.131-29.43,0c-8.131,8.124-8.131,21.306,0,29.43l119.328,119.328    c4.065,4.065,9.387,6.098,14.715,6.098c5.321,0,10.649-2.033,14.715-6.098C514.033,497.778,514.033,484.596,505.902,476.472z"/></g></g></symbol><symbol id="font-size-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M11.246 15H4.754l-2 5H.6L7 4h2l6.4 16h-2.154l-2-5zm-.8-2L8 6.885 5.554 13h4.892zM21 12.535V12h2v8h-2v-.535a4 4 0 1 1 0-6.93zM19 18a2 2 0 1 0 0-4 2 2 0 0 0 0 4z"/></symbol><symbol id="add-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M11 11V5h2v6h6v2h-6v6h-2v-6H5v-2z"/></symbol><symbol id="minus-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M5 11h14v2H5z"/></symbol><symbol id="dark-theme-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M10 7a7 7 0 0 0 12 4.9v.1c0 5.523-4.477 10-10 10S2 17.523 2 12 6.477 2 12 2h.1A6.979 6.979 0 0 0 10 7zm-6 5a8 8 0 0 0 15.062 3.762A9 9 0 0 1 8.238 4.938 7.999 7.999 0 0 0 4 12z"/></symbol><symbol id="light-theme-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M12 18a6 6 0 1 1 0-12 6 6 0 0 1 0 12zm0-2a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM11 1h2v3h-2V1zm0 19h2v3h-2v-3zM3.515 4.929l1.414-1.414L7.05 5.636 5.636 7.05 3.515 4.93zM16.95 18.364l1.414-1.414 2.121 2.121-1.414 1.414-2.121-2.121zm2.121-14.85l1.414 1.415-2.121 2.121-1.414-1.414 2.121-2.121zM5.636 16.95l1.414 1.414-2.121 2.121-1.414-1.414 2.121-2.121zM23 11v2h-3v-2h3zM4 11v2H1v-2h3z"/></symbol><symbol id="reset-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M18.537 19.567A9.961 9.961 0 0 1 12 22C6.477 22 2 17.523 2 12S6.477 2 12 2s10 4.477 10 10c0 2.136-.67 4.116-1.81 5.74L17 12h3a8 8 0 1 0-2.46 5.772l.997 1.795z"/></symbol><symbol id="down-icon" viewBox="0 0 16 16"><path fill-rule="evenodd" clip-rule="evenodd" d="M12.7803 6.21967C13.0732 6.51256 13.0732 6.98744 12.7803 7.28033L8.53033 11.5303C8.23744 11.8232 7.76256 11.8232 7.46967 11.5303L3.21967 7.28033C2.92678 6.98744 2.92678 6.51256 3.21967 6.21967C3.51256 5.92678 3.98744 5.92678 4.28033 6.21967L8 9.93934L11.7197 6.21967C12.0126 5.92678 12.4874 5.92678 12.7803 6.21967Z"></path></symbol><symbol id="codepen-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M16.5 13.202L13 15.535v3.596L19.197 15 16.5 13.202zM14.697 12L12 10.202 9.303 12 12 13.798 14.697 12zM20 10.869L18.303 12 20 13.131V10.87zM19.197 9L13 4.869v3.596l3.5 2.333L19.197 9zM7.5 10.798L11 8.465V4.869L4.803 9 7.5 10.798zM4.803 15L11 19.131v-3.596l-3.5-2.333L4.803 15zM4 13.131L5.697 12 4 10.869v2.262zM2 9a1 1 0 0 1 .445-.832l9-6a1 1 0 0 1 1.11 0l9 6A1 1 0 0 1 22 9v6a1 1 0 0 1-.445.832l-9 6a1 1 0 0 1-1.11 0l-9-6A1 1 0 0 1 2 15V9z"/></symbol><symbol id="close-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M12 10.586l4.95-4.95 1.414 1.414-4.95 4.95 4.95 4.95-1.414 1.414-4.95-4.95-4.95 4.95-1.414-1.414 4.95-4.95-4.95-4.95L7.05 5.636z"/></symbol><symbol id="menu-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M3 4h18v2H3V4zm0 7h18v2H3v-2zm0 7h18v2H3v-2z"/></symbol></defs></svg></head><body data-theme="dark"><div class="sidebar-container"><div class="sidebar" id="sidebar"><a href="/" class="sidebar-title sidebar-title-anchor">DynamoBao</a><div class="sidebar-items-container"><div class="sidebar-section-title with-arrow" data-isopen="false" id="sidebar-tutorials"><div>Tutorials</div><svg><use xlink:href="#down-icon"></use></svg></div><div class="sidebar-section-children-container"><div class="sidebar-section-children"><a href="tutorial-01-model-definitions.html">Model Definitions</a></div><div class="sidebar-section-children"><a href="tutorial-02-query-and-filter.html">Querying and Filtering</a></div><div class="sidebar-section-children"><a href="tutorial-04-changing-models.html">Modifying Models</a></div><div class="sidebar-section-children"><a href="tutorial-05-ttl-fields.html">Time-to-live (TTL) Fields</a></div><div class="sidebar-section-children"><a href="tutorial-06-custom-fields.html">Custom Fields</a></div><div class="sidebar-section-children"><a href="tutorial-07-command-line-tools.html">Command Line Tools</a></div></div><div class="sidebar-section-title with-arrow" data-isopen="false" id="sidebar-namespaces"><div>Namespaces</div><svg><use xlink:href="#down-icon"></use></svg></div><div class="sidebar-section-children-container"><div class="sidebar-section-children"><a href="BaoFields.html">BaoFields</a></div></div><div class="sidebar-section-title with-arrow" data-isopen="false" id="sidebar-classes"><div>Classes</div><svg><use xlink:href="#down-icon"></use></svg></div><div class="sidebar-section-children-container"><div class="sidebar-section-children"><a href="BaoFields.BaoBaseField.html">BaoBaseField</a></div><div class="sidebar-section-children"><a href="BaoFields.BinaryField.html">BinaryField</a></div><div class="sidebar-section-children"><a href="BaoFields.BooleanField.html">BooleanField</a></div><div class="sidebar-section-children"><a href="BaoFields.CounterField.html">CounterField</a></div><div class="sidebar-section-children"><a href="BaoFields.CreateDateField.html">CreateDateField</a></div><div class="sidebar-section-children"><a href="BaoFields.DateTimeField.html">DateTimeField</a></div><div class="sidebar-section-children"><a href="BaoFields.FloatField.html">FloatField</a></div><div class="sidebar-section-children"><a href="BaoFields.IntegerField.html">IntegerField</a></div><div class="sidebar-section-children"><a href="BaoFields.ModifiedDateField.html">ModifiedDateField</a></div><div class="sidebar-section-children"><a href="BaoFields.RelatedField.html">RelatedField</a></div><div class="sidebar-section-children"><a href="BaoFields.StringField.html">StringField</a></div><div class="sidebar-section-children"><a href="BaoFields.TtlField.html">TtlField</a></div><div class="sidebar-section-children"><a href="BaoFields.UlidField.html">UlidField</a></div><div class="sidebar-section-children"><a href="BaoFields.VersionField.html">VersionField</a></div><div class="sidebar-section-children"><a href="BaoModel.html">BaoModel</a></div><div class="sidebar-section-children"><a href="FilterExpressionBuilder.html">FilterExpressionBuilder</a></div><div class="sidebar-section-children"><a href="ObjectNotFound.html">ObjectNotFound</a></div></div></div></div></div><div class="navbar-container" id="VuAckcnZhf"><nav class="navbar"><div class="navbar-left-items"><div class="navbar-item"><a id="" href="https://github.com/adriangraham/dynamo-bao" target="_blank">ðŸ”— Github</a></div><div class="navbar-item"><a id="" href="https://www.npmjs.com/package/dynamo-bao" target="_blank">ðŸ“¦ NPM</a></div></div><div class="navbar-right-items"><div class="navbar-right-item"><button class="icon-button search-button" aria-label="open-search"><svg><use xlink:href="#search-icon"></use></svg></button></div><div class="navbar-right-item"><button class="icon-button theme-toggle" aria-label="toggle-theme"><svg><use class="theme-svg-use" xlink:href="#light-theme-icon"></use></svg></button></div><div class="navbar-right-item"><button class="icon-button font-size" aria-label="change-font-size"><svg><use xlink:href="#font-size-icon"></use></svg></button></div></div><nav></nav></nav></div><div class="toc-container"><div class="toc-content"><span class="bold">On this page</span><div id="eed4d2a0bfd64539bb9df78095dec881"></div></div></div><div class="body-wrapper"><div class="main-content"><div class="main-wrapper"><section id="source-page" class="source-page"><header><h1 id="title" class="has-anchor">fields.js</h1></header><article><pre class="prettyprint source lang-js"><code>/**
 * @namespace BaoFields
 * @description
 * This module contains the built-in fields for Bao.
 */
const { ulid, decodeTime } = require("ulid");
const { defaultLogger: logger } = require("./utils/logger");

/**
 * @class BaoBaseField
 * @memberof BaoFields
 * @description
 * Base class for all fields. Do not instantiate this class directly.
 */
class BaoBaseField {
  constructor(options = {}) {
    this.options = options;
    this.required = options.required || false;
    this.defaultValue = options.defaultValue;
  }

  /**
   * @memberof BaoFields.BaoBaseField
   * @description
   * Get the initial JS value for the field.
   * @returns {any} The initial value for the field.
   */
  getInitialValue() {
    if (this.defaultValue) {
      return typeof this.defaultValue === "function"
        ? this.defaultValue()
        : this.defaultValue;
    }
    return undefined;
  }

  /**
   * @memberof BaoFields.BaoBaseField
   * @description
   * Validate the JS field value.
   * @param {any} value - The value to validate.
   * @returns {boolean} True if the value is valid, otherwise false.
   */
  validate(value) {
    if (this.required &amp;&amp; (value === null || value === undefined)) {
      throw new Error("Field is required");
    }
    return true;
  }

  /**
   * @memberof BaoFields.BaoBaseField
   * @description
   * Convert the field value from the JS representation to DynamoDB representation.
   * @param {any} value - The value to convert.
   * @returns {any} The converted value.
   */
  toDy(value) {
    return value;
  }

  /**
   * @memberof BaoFields.BaoBaseField
   * @description
   * Convert the field value from the DynamoDB representation to the JS representation.
   * @param {any} value - The value to convert.
   * @returns {any} The converted value.
   */
  fromDy(value) {
    return value;
  }

  /**
   * @memberof BaoFields.BaoBaseField
   * @description
   * Convert the field value from the JS representation the index format used by DynamoDB.
   * This must be a string representation of the value. Pay special attention to
   * how this value sorts since it will be used for sort keys.
   * @param {any} value - The value to convert.
   * @returns {any} The converted value.
   */
  toGsi(value) {
    return String(value);
  }

  /**
   * @memberof BaoFields.BaoBaseField
   * @description
   * Convert the field value from the index format used by DynamoDB to the JS representation.
   * @param {any} value - The value to convert.
   * @returns {any} The converted value.
   */
  fromGsi(value) {
    return this.fromDy(value);
  }

  /**
   * @memberof BaoFields.BaoBaseField
   * @description
   * Get the DynamoDB update expression for the field. You usually don't need to override this.
   * By default, it will return a SET expression, unless the value is null. If the value is null,
   * it will remove the attribute from the item .
   *
   * @param {string} fieldName - The name of the field.
   * @param {any} value - The value to update.
   * @returns {Object} The update expression.
   */
  getUpdateExpression(fieldName, value) {
    if (value === undefined) return null;

    const attributeName = `#${fieldName}`;
    const attributeValue = `:${fieldName}`;

    if (value === null) {
      return {
        type: "REMOVE",
        expression: `${attributeName}`,
        attrNameKey: attributeName,
        attrValueKey: attributeValue,
        fieldName: fieldName,
        fieldValue: null,
      };
    }

    return {
      type: "SET",
      expression: `${attributeName} = ${attributeValue}`,
      attrNameKey: attributeName,
      attrValueKey: attributeValue,
      fieldName: fieldName,
      fieldValue: value,
    };
  }

  /**
   * @memberof BaoFields.BaoBaseField
   * @description
   * Update the field value before saving. An example of where you might override this
   * is a modified date field that you want to update to the current date/time before
   * saving.
   * @param {any} value - The value to update.
   * @param {BaoModel} currentObject - The current model instance.
   * @returns {any} The updated value.
   */
  updateBeforeSave(value, currentObject) {
    // Default implementation does nothing
    return value;
  }
}

/**
 * @class StringField
 * @memberof BaoFields
 * @description
 * A field that stores a string value.
 */
class StringField extends BaoBaseField {
  // String fields are pass-through since DynamoDB handles them natively
}

/**
 * @class DateTimeField
 * @memberof BaoFields
 * @description
 * A field that stores a date/time value.
 */
class DateTimeField extends BaoBaseField {
  validate(value) {
    if (this.required &amp;&amp; value === undefined) {
      throw new Error("Field is required");
    }
    if (
      value !== undefined &amp;&amp;
      !(value instanceof Date) &amp;&amp;
      typeof value !== "number" &amp;&amp;
      typeof value !== "string"
    ) {
      throw new Error(
        "DateTimeField value must be a Date object, timestamp number, or ISO string",
      );
    }
  }

  toDy(value) {
    if (!value) return null;

    try {
      // Convert any input to timestamp
      if (value instanceof Date) {
        return value.getTime();
      }
      if (typeof value === "string") {
        return new Date(value).getTime();
      }
      if (typeof value === "number") {
        return value;
      }
      return null;
    } catch (error) {
      console.warn("Error converting date value:", error);
      return null;
    }
  }

  fromDy(value) {
    if (!value) return null;
    try {
      return new Date(Number(value));
    } catch (error) {
      console.warn("Error parsing date value:", error);
      return null;
    }
  }

  toGsi(value) {
    if (!value) return "0";
    try {
      // Convert to timestamp string with padding for correct sorting
      const timestamp = this.toDy(value);
      if (!timestamp) return "0";
      const result = timestamp.toString().padStart(20, "0");
      // logger.log('Converting to GSI:', { value, timestamp, result });
      return result;
    } catch (error) {
      console.warn("Error converting date for GSI:", error);
      return "0";
    }
  }
}

/**
 * @class IntegerField
 * @memberof BaoFields
 * @description
 * A field that stores an integer value.
 */
class IntegerField extends BaoBaseField {
  getInitialValue() {
    return this.options.defaultValue !== undefined
      ? this.options.defaultValue
      : null;
  }

  toDy(value) {
    if (value === undefined || value === null) {
      return this.getInitialValue();
    }
    return Number(value);
  }

  fromDy(value) {
    if (value === undefined || value === null) {
      return this.getInitialValue();
    }
    return parseInt(value, 10);
  }

  toGsi(value) {
    // Pad with zeros for proper string sorting
    return value != null ? value.toString().padStart(20, "0") : "";
  }
}

/**
 * @class FloatField
 * @memberof BaoFields
 * @description
 * A field that stores a floating point number value.
 */
class FloatField extends BaoBaseField {
  getInitialValue() {
    return this.options.defaultValue !== undefined
      ? this.options.defaultValue
      : null;
  }

  toDy(value) {
    if (value === undefined || value === null) {
      return this.getInitialValue();
    }
    const num = Number(value);
    if (this.options.precision !== undefined &amp;&amp; !isNaN(num)) {
      return Number(num.toFixed(this.options.precision));
    }
    return num;
  }

  fromDy(value) {
    if (value === undefined || value === null) {
      return this.getInitialValue();
    }
    return parseFloat(value);
  }

  toGsi(value) {
    // Scientific notation with padding for consistent sorting
    return value != null ? value.toExponential(20) : "";
  }
}

/**
 * @class CreateDateField
 * @memberof BaoFields
 * @description
 * A field that stores a date/time value based on when the object was created.
 */
class CreateDateField extends DateTimeField {
  constructor(options = {}) {
    super({
      ...options,
      required: true,
    });
  }

  getInitialValue() {
    return new Date();
  }

  toDy(value) {
    if (!value) {
      return Date.now();
    }
    return value instanceof Date ? value.getTime() : value;
  }
}

/**
 * @class ModifiedDateField
 * @memberof BaoFields
 * @description
 * A field that stores a date/time value based on when the object was last modified.
 */
class ModifiedDateField extends DateTimeField {
  constructor(options = {}) {
    super({
      ...options,
      required: true,
    });
  }

  getInitialValue() {
    return new Date();
  }

  toDy(value) {
    return Date.now();
  }

  updateBeforeSave(value, currentObject) {
    // Always update modified date before save
    return Date.now();
  }
}

/**
 * @class UlidField
 * @memberof BaoFields
 * @description
 * A field that stores a {@link https://github.com/ulid/spec ULID} value.
 */
class UlidField extends BaoBaseField {
  constructor(options = {}) {
    super({
      ...options,
      required: true,
    });
    this.autoAssign = options.autoAssign || false;
  }

  getInitialValue() {
    if (this.autoAssign) {
      return ulid();
    }
    return super.getInitialValue();
  }

  validate(value) {
    if (!value &amp;&amp; !this.autoAssign) {
      throw new Error("ULID is required");
    }

    if (value) {
      // Check if it's a valid ULID format
      // ULIDs are 26 characters, uppercase alphanumeric
      if (!/^[0-9A-Z]{26}$/.test(value)) {
        throw new Error("Invalid ULID format");
      }

      try {
        // Attempt to decode the timestamp to verify it's valid
        decodeTime(value);
      } catch (error) {
        throw new Error("Invalid ULID: could not decode timestamp");
      }
    }
    return true;
  }

  // toDy now only handles conversion, not generation
  toDy(value) {
    return value;
  }

  toGsi(value) {
    return value || "";
  }
}

/**
 * @class RelatedField
 * @memberof BaoFields
 * @description
 * A field that points to another object in the database. This field makes
 * it easy to load related objects.
 */
class RelatedField extends BaoBaseField {
  constructor(modelName, options = {}) {
    super(options);
    this.modelName = modelName;
  }

  validate(value) {
    if (this.required &amp;&amp; !value) {
      throw new Error("Field is required");
    }
    // Allow both string IDs and model instances
    if (
      value &amp;&amp;
      typeof value !== "string" &amp;&amp;
      (!value.getPrimaryId || typeof value.getPrimaryId !== "function")
    ) {
      throw new Error(
        "Related field value must be a string ID or model instance",
      );
    }
    return true;
  }

  toDy(value) {
    if (!value) return null;
    // If we're given a model instance, get its ID
    if (typeof value === "object" &amp;&amp; value.getPrimaryId) {
      return value.getPrimaryId();
    }
    return value;
  }

  fromDy(value) {
    return value;
  }

  toGsi(value) {
    return this.toDy(value) || "";
  }
}

/**
 * @class CounterField
 * @memberof BaoFields
 * @description
 * A field that stores an integer value that can be incremented or decremented atomically.
 */
class CounterField extends BaoBaseField {
  constructor(options = {}) {
    super(options);
    this.defaultValue = options.defaultValue || 0;
  }

  validate(value) {
    super.validate(value);
    if (value !== undefined) {
      // Accept increment/decrement operations (e.g., '+1', '-5')
      if (typeof value === "string" &amp;&amp; /^[+-]\d+$/.test(value)) {
        return true;
      }
      // Accept regular integer values
      if (!Number.isInteger(value)) {
        throw new Error("CounterField value must be an integer");
      }
    }
    return true;
  }

  getInitialValue() {
    return this.defaultValue;
  }

  toDy(value) {
    if (
      typeof value === "string" &amp;&amp;
      (value.startsWith("+") || value.startsWith("-"))
    ) {
      return value;
    }
    return super.toDy(value);
  }

  fromDy(value) {
    if (value === undefined || value === null) {
      return this.getInitialValue();
    }
    return parseInt(value, 10);
  }

  getUpdateExpression(fieldName, value) {
    if (value === undefined) return null;

    const attributeName = `#${fieldName}`;
    const attributeValue = `:${fieldName}`;

    let expObj = {
      attrNameKey: attributeName,
      attrValueKey: attributeValue,
      type: "SET",
      expression: `${attributeName} = ${attributeValue}`,
      fieldName: fieldName,
      fieldValue: value,
    };

    logger.log("CounterField - getUpdateExpression", fieldName, value);

    if (value === null) {
      expObj = {
        ...expObj,
        type: "REMOVE",
        expression: `${attributeName}`,
        fieldValue: null,
      };
    }

    // If the value is relative (has + or - prefix), use ADD
    if (
      typeof value === "string" &amp;&amp;
      (value.startsWith("+") || value.startsWith("-"))
    ) {
      const numericValue = parseInt(value, 10);

      // Return just the expression part without the ADD keyword
      expObj = {
        ...expObj,
        type: "ADD",
        expression: `${attributeName} ${attributeValue}`,
        fieldValue: numericValue,
      };
    }

    return expObj;
  }

  toGsi(value) {
    return value != null ? value.toString().padStart(20, "0") : "";
  }
}

/**
 * @class BinaryField
 * @memberof BaoFields
 * @description
 * A field that stores a binary value.
 */
class BinaryField extends BaoBaseField {
  getInitialValue() {
    if (this.defaultValue) {
      return typeof this.defaultValue === "function"
        ? this.defaultValue()
        : this.defaultValue;
    }
    return null;
  }

  validate(value) {
    super.validate(value);
    if (
      value !== undefined &amp;&amp;
      value !== null &amp;&amp;
      !(value instanceof Buffer) &amp;&amp;
      !(value instanceof Uint8Array)
    ) {
      throw new Error("BinaryField value must be a Buffer or Uint8Array");
    }
    return true;
  }

  toDy(value) {
    if (!value) return null;

    return value;
  }

  fromDy(value) {
    if (!value) return null;
    return value;
  }

  toGsi(value) {
    throw new Error("BinaryField does not support GSI conversion");
  }
}

/**
 * @class VersionField
 * @memberof BaoFields
 * @description
 * A field that stores a ULID value that is used to track the version of the object.
 * You can use this field to implement optimistic locking by using the version field
 * as a condition in your update operation.
 */
class VersionField extends BaoBaseField {
  constructor(options = {}) {
    super({
      ...options,
      required: true,
    });
    this.defaultValue = options.defaultValue || ulid;
  }

  validate(value) {
    super.validate(value);
    if (value !== undefined) {
      // Verify it's a valid ULID string
      if (typeof value !== "string" || value.length !== 26) {
        throw new Error("VersionField value must be a valid ULID");
      }
    }
    return true;
  }

  getInitialValue() {
    return typeof this.defaultValue === "function"
      ? this.defaultValue()
      : this.defaultValue;
  }

  updateBeforeSave(value) {
    return ulid();
  }

  fromDy(value) {
    return value || this.getInitialValue();
  }

  toDy(value) {
    return value || this.getInitialValue();
  }
}

/**
 * @class BooleanField
 * @memberof BaoFields
 * @description
 * A field that stores a boolean value.
 */
class BooleanField extends BaoBaseField {
  validate(value) {
    super.validate(value);
    if (value !== undefined &amp;&amp; value !== null &amp;&amp; typeof value !== "boolean") {
      throw new Error("BooleanField value must be a boolean");
    }
    return true;
  }

  getInitialValue() {
    return this.defaultValue !== undefined ? this.defaultValue : null;
  }

  toDy(value) {
    if (value === undefined || value === null) {
      return this.getInitialValue();
    }
    return Boolean(value);
  }

  fromDy(value) {
    if (value === undefined || value === null) {
      return this.getInitialValue();
    }
    return Boolean(value);
  }

  toGsi(value) {
    if (value === undefined || value === null) {
      return "";
    }
    // Convert to '0' or '1' for consistent string sorting
    return value ? "1" : "0";
  }
}

/**
 * @class TtlField
 * @memberof BaoFields
 * @description
 * A field that stores a Unix timestamp in seconds that indicates when the object should be deleted.
 * DynamoDB will automatically delete the item at the specified time. This
 * field must be named "ttl" for DynamoDB to automatically delete the item.
 */
class TtlField extends DateTimeField {
  validate(value) {
    if (value === null || value === undefined) {
      return true; // Allow null/undefined for field removal
    }
    return super.validate(value); // Use parent validation for dates
  }

  toDy(value) {
    logger.log("TTL toDy", value);
    if (value === undefined) return undefined; // Skip field
    if (value === null) return null; // Remove field

    // Convert any valid date input to Unix timestamp in seconds
    let date;
    if (value instanceof Date) {
      date = value;
    } else {
      date = new Date(value);
      if (isNaN(date.getTime())) {
        throw new Error("Invalid date value provided for TTL field");
      }
    }

    const timestamp = Math.floor(date.getTime() / 1000);
    return timestamp;
  }

  fromDy(value) {
    logger.log("TTL fromDy", value);
    if (value === undefined || value === null) {
      return null; // Convert both undefined and null to null
    }
    return new Date(value * 1000);
  }
}

// Factory functions for creating field instances
const createStringField = (options) => new StringField(options);
const createDateTimeField = (options) => new DateTimeField(options);
const createCreateDateField = (options) => new CreateDateField(options);
const createModifiedDateField = (options) => new ModifiedDateField(options);
const createUlidField = (options) => new UlidField(options);
const createRelatedField = (modelName, options) =>
  new RelatedField(modelName, options);
const createIntegerField = (options) => new IntegerField(options);
const createFloatField = (options) => new FloatField(options);
const createCounterField = (options) => new CounterField(options);
const createBinaryField = (options) => new BinaryField(options);
const createVersionField = (options) => new VersionField(options);
const createBooleanField = (options) => new BooleanField(options);
const createTtlField = (options) => new TtlField(options);

// Export both the factory functions and the classes
module.exports = {
  // Factory functions
  StringField: createStringField,
  DateTimeField: createDateTimeField,
  CreateDateField: createCreateDateField,
  ModifiedDateField: createModifiedDateField,
  UlidField: createUlidField,
  RelatedField: createRelatedField,
  IntegerField: createIntegerField,
  FloatField: createFloatField,
  CounterField: createCounterField,
  BinaryField: createBinaryField,
  VersionField: createVersionField,
  BooleanField: createBooleanField,
  TtlField: createTtlField,

  // Classes (for instanceof checks)
  StringFieldClass: StringField,
  DateTimeFieldClass: DateTimeField,
  CreateDateFieldClass: CreateDateField,
  ModifiedDateFieldClass: ModifiedDateField,
  UlidFieldClass: UlidField,
  RelatedFieldClass: RelatedField,
  IntegerFieldClass: IntegerField,
  FloatFieldClass: FloatField,
  CounterFieldClass: CounterField,
  BinaryFieldClass: BinaryField,
  VersionFieldClass: VersionField,
  BooleanFieldClass: BooleanField,
  TtlFieldClass: TtlField,
};
</code></pre></article></section></div></div></div><div class="search-container" id="PkfLWpAbet" style="display:none"><div class="wrapper" id="iCxFxjkHbP"><button class="icon-button search-close-button" id="VjLlGakifb" aria-label="close search"><svg><use xlink:href="#close-icon"></use></svg></button><div class="search-box-c"><svg><use xlink:href="#search-icon"></use></svg> <input type="text" id="vpcKVYIppa" class="search-input" placeholder="Search..." autofocus></div><div class="search-result-c" id="fWwVHRuDuN"><span class="search-result-c-text">Type anything to view search result</span></div></div></div><div class="mobile-menu-icon-container"><button class="icon-button" id="mobile-menu" data-isopen="false" aria-label="menu"><svg><use xlink:href="#menu-icon"></use></svg></button></div><div id="mobile-sidebar" class="mobile-sidebar-container"><div class="mobile-sidebar-wrapper"><a href="/" class="sidebar-title sidebar-title-anchor">DynamoBao</a><div class="mobile-nav-links"><div class="navbar-item"><a id="" href="https://github.com/adriangraham/dynamo-bao" target="_blank">ðŸ”— Github</a></div><div class="navbar-item"><a id="" href="https://www.npmjs.com/package/dynamo-bao" target="_blank">ðŸ“¦ NPM</a></div></div><div class="mobile-sidebar-items-c"><div class="sidebar-section-title with-arrow" data-isopen="false" id="sidebar-tutorials"><div>Tutorials</div><svg><use xlink:href="#down-icon"></use></svg></div><div class="sidebar-section-children-container"><div class="sidebar-section-children"><a href="tutorial-01-model-definitions.html">Model Definitions</a></div><div class="sidebar-section-children"><a href="tutorial-02-query-and-filter.html">Querying and Filtering</a></div><div class="sidebar-section-children"><a href="tutorial-04-changing-models.html">Modifying Models</a></div><div class="sidebar-section-children"><a href="tutorial-05-ttl-fields.html">Time-to-live (TTL) Fields</a></div><div class="sidebar-section-children"><a href="tutorial-06-custom-fields.html">Custom Fields</a></div><div class="sidebar-section-children"><a href="tutorial-07-command-line-tools.html">Command Line Tools</a></div></div><div class="sidebar-section-title with-arrow" data-isopen="false" id="sidebar-namespaces"><div>Namespaces</div><svg><use xlink:href="#down-icon"></use></svg></div><div class="sidebar-section-children-container"><div class="sidebar-section-children"><a href="BaoFields.html">BaoFields</a></div></div><div class="sidebar-section-title with-arrow" data-isopen="false" id="sidebar-classes"><div>Classes</div><svg><use xlink:href="#down-icon"></use></svg></div><div class="sidebar-section-children-container"><div class="sidebar-section-children"><a href="BaoFields.BaoBaseField.html">BaoBaseField</a></div><div class="sidebar-section-children"><a href="BaoFields.BinaryField.html">BinaryField</a></div><div class="sidebar-section-children"><a href="BaoFields.BooleanField.html">BooleanField</a></div><div class="sidebar-section-children"><a href="BaoFields.CounterField.html">CounterField</a></div><div class="sidebar-section-children"><a href="BaoFields.CreateDateField.html">CreateDateField</a></div><div class="sidebar-section-children"><a href="BaoFields.DateTimeField.html">DateTimeField</a></div><div class="sidebar-section-children"><a href="BaoFields.FloatField.html">FloatField</a></div><div class="sidebar-section-children"><a href="BaoFields.IntegerField.html">IntegerField</a></div><div class="sidebar-section-children"><a href="BaoFields.ModifiedDateField.html">ModifiedDateField</a></div><div class="sidebar-section-children"><a href="BaoFields.RelatedField.html">RelatedField</a></div><div class="sidebar-section-children"><a href="BaoFields.StringField.html">StringField</a></div><div class="sidebar-section-children"><a href="BaoFields.TtlField.html">TtlField</a></div><div class="sidebar-section-children"><a href="BaoFields.UlidField.html">UlidField</a></div><div class="sidebar-section-children"><a href="BaoFields.VersionField.html">VersionField</a></div><div class="sidebar-section-children"><a href="BaoModel.html">BaoModel</a></div><div class="sidebar-section-children"><a href="FilterExpressionBuilder.html">FilterExpressionBuilder</a></div><div class="sidebar-section-children"><a href="ObjectNotFound.html">ObjectNotFound</a></div></div></div><div class="mobile-navbar-actions"><div class="navbar-right-item"><button class="icon-button search-button" aria-label="open-search"><svg><use xlink:href="#search-icon"></use></svg></button></div><div class="navbar-right-item"><button class="icon-button theme-toggle" aria-label="toggle-theme"><svg><use class="theme-svg-use" xlink:href="#light-theme-icon"></use></svg></button></div><div class="navbar-right-item"><button class="icon-button font-size" aria-label="change-font-size"><svg><use xlink:href="#font-size-icon"></use></svg></button></div></div></div></div><script type="text/javascript" src="scripts/core.min.js"></script><script src="scripts/search.min.js" defer="defer"></script><script src="scripts/third-party/fuse.js" defer="defer"></script><script type="text/javascript">var tocbotInstance=tocbot.init({tocSelector:"#eed4d2a0bfd64539bb9df78095dec881",contentSelector:".main-content",headingSelector:"h1, h2, h3",hasInnerContainers:!0,scrollContainer:".main-content",headingsOffset:130,onClick:bringLinkToView})</script></body></html>